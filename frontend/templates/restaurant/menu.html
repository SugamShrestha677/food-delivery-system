{% extends "sidebar.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/show.css' %}">

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Header -->
            <header class="bg-white border-b border-brand-light-gray px-4 md:px-8 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <button id="mobileMenuBtn" class="md:hidden p-2 text-brand-gray hover:bg-brand-light-gray rounded-lg">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                        <h1 class="text-xl md:text-2xl font-bold text-black">Menu Management</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <button id="addItemBtn" class="bg-brand-orange hover:bg-brand-orange/90 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span class="hidden sm:inline">Add Item</span>
                        </button>
                        <div class="relative">
                            <button class="p-2 text-brand-gray hover:bg-brand-light-gray rounded-lg">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9 7H4l5-5v5zM15 7h5l-5-5v5zM9 17H4l5 5v-5z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="w-8 h-8 bg-brand-light-gray rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-brand-gray" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main class="flex-1 p-4 md:p-8 overflow-auto">
                <!-- Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-6">
                    <div class="bg-white border border-brand-light-gray rounded-lg p-4 md:p-6 stats-card">
                        <div class="text-sm text-brand-gray mb-1">Total Items</div>
                        <div class="text-2xl font-bold text-black mb-1" id="totalItemsCount">6</div>
                        <div class="text-xs text-brand-gray" id="availableItemsCount">5 available</div>
                    </div>
                    <div class="bg-white border border-brand-light-gray rounded-lg p-4 md:p-6 stats-card">
                        <div class="text-sm text-brand-gray mb-1">Categories</div>
                        <div class="text-2xl font-bold text-black mb-1" id="categoriesCount">6</div>
                        <div class="text-xs text-brand-gray">Active categories</div>
                    </div>
                    <div class="bg-white border border-brand-light-gray rounded-lg p-4 md:p-6 stats-card">
                        <div class="text-sm text-brand-gray mb-1">Avg. Price</div>
                        <div class="text-2xl font-bold text-black mb-1" id="avgPrice">$45.24</div>
                        <div class="text-xs text-brand-gray">Across all items</div>
                    </div>
                    <div class="bg-white border border-brand-light-gray rounded-lg p-4 md:p-6 stats-card">
                        <div class="text-sm text-brand-gray mb-1">Vegetarian</div>
                        <div class="text-2xl font-bold text-black mb-1" id="vegetarianCount">4</div>
                        <div class="text-xs text-brand-gray" id="veganCount">1 vegan</div>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white border border-brand-light-gray rounded-lg p-4 mb-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1 relative">
                            <svg class="w-5 h-5 text-brand-gray absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <input 
                                type="text" 
                                id="searchInput"
                                placeholder="Search menu items by name, description, or ingredients..."
                                class="w-full pl-10 pr-4 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent"
                            >
                        </div>
                        <select id="categoryFilter" class="px-4 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent">
                            <option value="all">All Categories</option>
                            <option value="Pizza">Pizza</option>
                            <option value="Pasta">Pasta</option>
                            <option value="Salads">Salads</option>
                            <option value="Desserts">Desserts</option>
                            <option value="Appetizers">Appetizers</option>
                            <option value="Beverages">Beverages</option>
                        </select>
                    </div>
                </div>

                <!-- Menu Items Section -->
                <div class="bg-white border border-brand-light-gray rounded-lg">
                    <div class="p-6 border-b border-brand-light-gray">
                        <h2 class="text-xl font-bold text-black">Menu Items</h2>
                        <p class="text-sm text-brand-gray mt-1">Manage your restaurant menu items</p>
                    </div>

                    <!-- Menu Items Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-brand-light-gray">
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Name</th>
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Category</th>
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Price</th>
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Status</th>
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Prep Time</th>
                                    <th class="text-left p-4 text-sm font-medium text-brand-gray">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="menuItemsTableBody">
                                <!-- Menu items will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="hidden p-8 text-center">
                        <svg class="w-16 h-16 text-brand-gray mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <h3 class="text-lg font-medium text-brand-gray mb-2">No menu items found</h3>
                        <p class="text-sm text-brand-gray">Try adjusting your search or filter criteria.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add/Edit Item Modal -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden modal-overlay">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg w-full max-w-2xl modal-content">
                <div class="p-6 border-b border-brand-light-gray">
                    <div class="flex items-center justify-between">
                        <h3 class="text-xl font-bold text-black" id="modalTitle">Add New Item</h3>
                        <button id="closeModal" class="p-2 text-brand-gray hover:bg-brand-light-gray rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <form id="itemForm" class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-brand-gray mb-2">Item Name</label>
                            <input type="text" id="itemName" class="w-full px-3 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-brand-gray mb-2">Description</label>
                            <textarea id="itemDescription" rows="3" class="w-full px-3 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent" required></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-gray mb-2">Category</label>
                            <select id="itemCategory" class="w-full px-3 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent" required>
                                <option value="">Select Category</option>
                                <option value="Pizza">Pizza</option>
                                <option value="Pasta">Pasta</option>
                                <option value="Salads">Salads</option>
                                <option value="Desserts">Desserts</option>
                                <option value="Appetizers">Appetizers</option>
                                <option value="Beverages">Beverages</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-gray mb-2">Price ($)</label>
                            <input type="number" id="itemPrice" step="0.01" min="0" class="w-full px-3 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-gray mb-2">Prep Time (minutes)</label>
                            <input type="text" id="itemPrepTime" min="1" class="w-full px-3 py-2 border border-brand-light-gray rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-orange focus:border-transparent" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-brand-gray mb-2">Item Image</label>
                            <input type="file" id="itemPhoto" accept="image/*" 
                                class="w-full px-3 py-2 border border-brand-light-gray rounded-lg 
                                        focus:outline-none focus:ring-2 focus:ring-brand-orange 
                                        focus:border-transparent">
                        </div>

                        <div class="md:col-span-2">
                            <div class="flex items-center gap-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="itemVegetarian" class="mr-2">
                                    <span class="text-sm text-brand-gray">Vegetarian</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="itemVegan" class="mr-2">
                                    <span class="text-sm text-brand-gray">Vegan</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="itemAvailable" class="mr-2" checked>
                                    <span class="text-sm text-brand-gray">Available</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end gap-3 mt-6">
                        <button type="button" id="cancelBtn" class="px-4 py-2 text-brand-gray border border-brand-light-gray rounded-lg hover:bg-brand-light-gray transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-brand-orange text-white rounded-lg hover:bg-brand-orange/90 transition-colors">
                            <span id="submitBtnText">Add Item</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


            
            <script>
            // Mobile menu functionality
        let menuItems = [];       // All menu items fetched from backend
        let filteredItems = [];   // Filtered items for search/category filtering
        let editingItemId = null;  // current item being edited
        let restaurantId = null;   // store restaurant ID
        


        const prepInput = document.getElementById("itemPrepTime").value;
const prepTimeMinutes = parseInt(prepInput, 10) || 0; // default to 0 if empty

const hours = Math.floor(prepTimeMinutes / 60).toString().padStart(2, '0');
const minutes = (prepTimeMinutes % 60).toString().padStart(2, '0');
const seconds = '00';

const durationStr = `${hours}:${minutes}:${seconds}`;

function convertHHMMSSToMinutes(durationStr) {
    if (!durationStr) return 0;
    const parts = durationStr.split(':'); // ["hh","mm","ss"]
    return parseInt(parts[0]) * 60 + parseInt(parts[1]);
}

        
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');

        function toggleMobileMenu() {
            sidebar.classList.toggle('sidebar-hidden');
            mobileOverlay.classList.toggle('hidden');
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        mobileOverlay.addEventListener('click', toggleMobileMenu);

        // Modal functionality
        const itemModal = document.getElementById('itemModal');
        const addItemBtn = document.getElementById('addItemBtn');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const itemForm = document.getElementById('itemForm');

        function openModal(item = null) {
            editingItemId = item ? item.id : null;
            const modalTitle = document.getElementById('modalTitle');
            const submitBtnText = document.getElementById('submitBtnText');

            if (item) {
                modalTitle.textContent = 'Edit Item';
                submitBtnText.textContent = 'Update Item';
                
                // Populate form with item data
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemDescription').value = item.description;
                document.getElementById('itemCategory').value = item.category;
                document.getElementById('itemPrice').value = item.price;
                document.getElementById('itemPrepTime').value = item.prepTime;
                document.getElementById('itemVegetarian').checked = item.vegetarian;
                document.getElementById('itemVegan').checked = item.vegan;
                document.getElementById('itemAvailable').checked = item.available;
            } else {
                modalTitle.textContent = 'Add New Item';
                submitBtnText.textContent = 'Add Item';
                itemForm.reset();
                document.getElementById('itemAvailable').checked = true;
            }

            itemModal.classList.remove('hidden');
            setTimeout(() => itemModal.classList.add('show'), 10);
        }

        function closeModalFunc() {
            itemModal.classList.remove('show');
            setTimeout(() => {
                itemModal.classList.add('hidden');
                editingItemId = null;
            }, 300);
        }

        addItemBtn.addEventListener('click', () => openModal());
        closeModal.addEventListener('click', closeModalFunc);
        cancelBtn.addEventListener('click', closeModalFunc);

        // Close modal when clicking outside
        itemModal.addEventListener('click', function(e) {
            if (e.target === itemModal) {
                closeModalFunc();
            }
        });

        async function fetchRestaurantProfile() {
    const token = localStorage.getItem("access_token");
    if (!token) {
        alert("You are not logged in!");
        return;
    }

    try {
        const response = await fetch("http://127.0.0.1:8000/api/restaurant/me/", {
            headers: { Authorization: `Bearer ${token}` }
        });
        const data = await response.json();
        console.log("✅ Restaurant profile fetched: ", data);
        restaurantId = data.id; // store the restaurant ID
    } catch (err) {
        console.error("Error fetching restaurant profile:", err);
    }
}



async function fetchMenuItems() {
    const token = localStorage.getItem("access_token");
    if (!token) {
        alert("You are not logged in!");
        return;
    }

    try {
        const response = await fetch("http://127.0.0.1:8000/api/restaurant/menu-items/", {
            headers: { Authorization: `Bearer ${token}` }
        });
        const data = await response.json();

        // Map backend fields to frontend expected fields
        menuItems = data.map(item => ({
            id: item.id,
            name: item.items,               // backend 'items' → frontend 'name'
            description: item.description,
            category: item.category || "",
            price: parseFloat(item.price),
            prepTime: item.estimated_time
,
            available: item.is_available,
            vegetarian: item.vegetarian || false,
            vegan: item.vegan || false,
            photo: item.photo || null
        }));

        filterItems();
        renderItems();
        updateStats();
    } catch (err) {
        console.error("Error fetching menu items:", err);
        alert("Failed to fetch menu items!");
    }
}


document.addEventListener("DOMContentLoaded", async function() {
    await fetchRestaurantProfile(); // fetch restaurantId first
    await fetchMenuItems(); 

    updateStats();
    filterItems();
    renderItems();
});


        // Form submission
itemForm.addEventListener('submit', async function(e) {
    e.preventDefault();

    const token = localStorage.getItem("access_token");
    if (!token) {
        alert("You are not logged in!");
        return;
    }

    // Prepare FormData
    const formData = new FormData();
    formData.append("items", document.getElementById("itemName").value);
    formData.append("description", document.getElementById("itemDescription").value);
    formData.append("price", parseFloat(document.getElementById("itemPrice").value));
    const prepMinutes = parseInt(document.getElementById("itemPrepTime").value, 10) || 0;
    const hours = Math.floor(prepMinutes / 60);
    const minutes = prepMinutes % 60;
    const prepTimeFormatted = `${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")}:00`;
    formData.append("estimated_time", prepTimeFormatted);
    formData.append("is_available", document.getElementById("itemAvailable").checked ? "true" : "false");
    formData.append("category", document.getElementById("itemCategory").value);

    const photoFile = document.getElementById("itemPhoto")?.files[0];
    if (photoFile) formData.append("photo", photoFile);

    try {
        let url = "http://127.0.0.1:8000/api/restaurant/menu-items/";
        let method = "POST";

        // If editing an existing item
        if (editingItemId) {
            url += `${editingItemId}/`;   // endpoint for specific item
            method = "PUT";               // or "PATCH" if partial update
        }

        const response = await fetch(url, {
            method: method,
            headers: {
                "Authorization": `Bearer ${token}` // DO NOT set Content-Type manually
            },
            body: formData
        });

        const data = await response.json();

        if (!response.ok) {
            console.error("Backend error:", data);
            alert("Error saving item! Check console for details.");
            return;
        }

        // Map backend response to frontend structure
        const updatedItem = {
            id: data.id,
            name: data.items,
            description: data.description,
            category: data.category || "",
            price: parseFloat(data.price),
            prepTime: data.estimated_time,
            available: data.is_available,
            vegetarian: data.vegetarian || false,
            vegan: data.vegan || false,
            photo: data.photo || null
        };

        if (editingItemId) {
            // Update the existing item in menuItems array
            const index = menuItems.findIndex(item => item.id === editingItemId);
            if (index !== -1) menuItems[index] = updatedItem;
            showNotification("Item updated successfully!");
        } else {
            // Add new item
            menuItems.push(updatedItem);
            showNotification("Item added successfully!");
        }

        updateStats();
        filterItems();
        renderItems();
        closeModalFunc();
        editingItemId = null; // reset after saving
    } catch (err) {
        console.error("Fetch error:", err);
        alert("Network error occurred!");
    }
});



        // Render menu items table
        function renderItems() {
            const tbody = document.getElementById('menuItemsTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredItems.length === 0) {
                tbody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            tbody.innerHTML = filteredItems.map(item => `
                <tr class="border-b border-brand-light-gray menu-item-row fade-in">
                    <td class="p-4">
                        <div class="flex flex-col">
                            <div class="font-medium text-black">${item.name}</div>
                            <div class="text-sm text-brand-gray mt-1">${item.description}</div>
                            <div class="flex gap-2 mt-2">
                                ${item.vegetarian ? '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Vegetarian</span>' : ''}
                                ${item.vegan ? '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Vegan</span>' : ''}
                            </div>
                        </div>
                    </td>
                    <td class="p-4 text-sm text-brand-gray">${item.category}</td>
                    <td class="p-4 text-sm text-black font-medium">$${item.price.toFixed(2)}</td>
                    <td class="p-4">
                        <label class="toggle-switch">
                            <input type="checkbox" ${item.available ? 'checked' : ''} onchange="toggleAvailability(${item.id})">
                            <span class="toggle-slider"></span>
                        </label>
                        <div class="text-xs mt-1 ${item.available ? 'text-brand-green' : 'text-brand-red'}">
                            ${item.available ? 'Available' : 'Unavailable'}
                        </div>
                    </td>
                    <td class="p-4 text-sm text-brand-gray">${item.prepTime} min</td>
                    <td class="p-4">
                        <div class="flex items-center gap-2">
                            <button onclick="editItem(${item.id})" class="p-2 text-brand-gray hover:text-brand-orange transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteItem(${item.id})" class="p-2 text-brand-gray hover:text-brand-red transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Toggle item availability
        function toggleAvailability(itemId) {
            const itemIndex = menuItems.findIndex(item => item.id === itemId);
            if (itemIndex !== -1) {
                menuItems[itemIndex].available = !menuItems[itemIndex].available;
                updateStats();
                filterItems();
                renderItems();
                
                const status = menuItems[itemIndex].available ? 'available' : 'unavailable';
                showNotification(`Item marked as ${status}`);
            }
        }

        // Edit item
        function editItem(itemId) {
            const item = menuItems.find(item => item.id === itemId);
            if (item) {
                openModal(item);
            }
        }

        // Delete item
        function deleteItem(itemId) {
    if (!confirm('Are you sure you want to delete this item?')) return;

    const token = localStorage.getItem("access_token");
    if (!token) {
        console.error("❌ No access token found in localStorage");
        return;
    }

    fetch(`http://127.0.0.1:8000/api/restaurant/menu-items/${itemId}/`, {
        method: "DELETE",
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
        }
    })
    .then(response => {
        if (response.ok) {
            // Remove item from frontend array and update UI
            menuItems = menuItems.filter(item => item.id !== itemId);
            updateStats();
            filterItems();
            renderItems();
            showNotification('Item deleted successfully');
        } else {
            console.error("❌ Failed to delete item. Status:", response.status);
            showNotification('Failed to delete item');
        }
    })
    .catch(error => {
        console.error("❌ Error deleting item:", error);
        showNotification('Error deleting item');
    });
}


        // Update statistics
        function updateStats() {
            const totalItems = menuItems.length;
            const availableItems = menuItems.filter(item => item.available).length;
            const categories = [...new Set(menuItems.map(item => item.category))].length;
            const avgPrice = menuItems.reduce((sum, item) => sum + item.price, 0) / totalItems;
            const vegetarianItems = menuItems.filter(item => item.vegetarian).length;
            const veganItems = menuItems.filter(item => item.vegan).length;

            document.getElementById('totalItemsCount').textContent = totalItems;
            document.getElementById('availableItemsCount').textContent = `${availableItems} available`;
            document.getElementById('categoriesCount').textContent = categories;
            document.getElementById('avgPrice').textContent = `$${avgPrice.toFixed(2)}`;
            document.getElementById('vegetarianCount').textContent = vegetarianItems;
            document.getElementById('veganCount').textContent = `${veganItems} vegan`;
        }

        // Filter items
        function filterItems() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredItems = menuItems.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm);
                
                const matchesCategory = categoryFilter === 'all' || item.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            filterItems();
            renderItems();
        });

        // Category filter functionality
        document.getElementById('categoryFilter').addEventListener('change', function() {
            filterItems();
            renderItems();
        });

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-brand-orange text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            filterItems();
            renderItems();
        });

        // Responsive handling
        window.addEventListener('resize', function() {
            if (window.innerWidth < 768) {
                sidebar.classList.add('sidebar-hidden');
                mobileOverlay.classList.add('hidden');
            }
        });
    </script>
{% endblock %}